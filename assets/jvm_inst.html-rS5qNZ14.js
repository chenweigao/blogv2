import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,d as r,o as n}from"./app-11Vuyqh7.js";const d={};function o(i,t){return n(),e("div",null,t[0]||(t[0]=[r('<h2 id="abstract" tabindex="-1"><a class="header-anchor" href="#abstract"><span>Abstract</span></a></h2><p>JAVA 字符串操作的优化。</p><h2 id="java-对象布局" tabindex="-1"><a class="header-anchor" href="#java-对象布局"><span>Java 对象布局</span></a></h2><h3 id="java-array-对象布局" tabindex="-1"><a class="header-anchor" href="#java-array-对象布局"><span>Java Array 对象布局</span></a></h3><table><thead><tr><th>Java Char Array</th><th></th><th></th></tr></thead><tbody><tr><td>Head</td><td>Mark Word</td><td>4 Bytes</td></tr><tr><td></td><td>Class Pointer</td><td>4 Bytes</td></tr><tr><td></td><td>Length of Array</td><td>Offset = 8</td></tr><tr><td>Instance Data</td><td>Data of Array</td><td></td></tr><tr><td>Padding</td><td></td><td></td></tr></tbody></table><p>Data of Array 中的每个 char 占 2 Bytes.</p><p>加载Length的流程包括：</p><ol><li>需要通过数组实例的基地址加载Length的值。</li><li>如果基地址错误，需要返回错误码。</li><li>如果length为0，需要返回错误码。</li></ol><p>字符串数组的简化布局：</p><p>+------------------+ | 对象头 | // 包含元数据 +------------------+ | length (int) | // 数组长度 (2) +------------------+ | 引用1 | // 指向 &quot;Hello&quot; 字符串对象 +------------------+ | 引用2 | // 指向 &quot;World&quot; 字符串对象 +------------------+</p><p>64 位 JVM 中，对象头为 16 字节，长度占 4 字节（存储字符串长度的 int），每一个引用占用 8 字节（32 位系统中占用 4 字节）</p><h3 id="java-string-对象布局" tabindex="-1"><a class="header-anchor" href="#java-string-对象布局"><span>Java String 对象布局</span></a></h3><table><thead><tr><th>Java String</th><th></th><th></th></tr></thead><tbody><tr><td>Head</td><td>Mark Word</td><td>4 Bytes</td></tr><tr><td></td><td>Class Pointer</td><td>4 Bytes</td></tr><tr><td>Instance Data</td><td>Data of Array</td><td>Offset=8</td></tr><tr><td></td><td>Raw Data</td><td></td></tr><tr><td>Padding</td><td></td><td></td></tr></tbody></table><p>加载Length的流程包括：</p><ol><li>需要通过 String 实例的基地址加载 Length 的值。</li><li>如果基地址错误，需要返回错误码。</li><li>如果length为0，需要返回错误码。</li><li>String 的 Length 的最低位是 TAG-bit，表示是否压缩，需要移位去除掉</li></ol><p>字符串的简化内存布局如下所示：</p><p>+------------------+ | 对象头 | // 包含元数据 +------------------+ | length (int) | // 字符串长度 +------------------+ | char[] | // 存储字符 &#39;H&#39;, &#39;e&#39;, &#39;l&#39;, &#39;l&#39;, &#39;o&#39; +------------------+</p><p>对象头，16 字节，长度 4 字节，每个字符占用 2 字节（因为 UTF-16 编码）</p><h3 id="常见对象的大小" tabindex="-1"><a class="header-anchor" href="#常见对象的大小"><span>常见对象的大小</span></a></h3><p>对于基本的数据类型： boolean: 1 字节（通常在对象中占用 4 字节或 8 字节，因为对象的对齐） byte: 1 字节 char: 2 字节（UTF-16 编码） short: 2 字节 int: 4 字节 float: 4 字节 long: 8 字节 double: 8 字节</p><p>对于对象头：对象头通常占用 12 字节（在 64 位 JVM 中，可能为 16 字节，具体取决于对象对齐和是否启用了指针压缩）</p><p>对于对象：大约 12 字节（在 64 位 JVM 中，可能为 16 字节） +---------------------+ | 对象头 | // 12 字节（或 16 字节） +---------------------+ | name (String) | // 4 字节（在 32 位 JVM 中）或 8 字节（在 64 位 JVM 中） +---------------------+ | age (int) | // 4 字节 +---------------------+ | 填充 (Padding) | // 可能存在，确保对齐 +---------------------+</p><h2 id="jinst" tabindex="-1"><a class="header-anchor" href="#jinst"><span>JInst</span></a></h2><ol><li>加载字符数组的长度，并检查对象的指针的合法性；</li><li>加载字符串对象的长度，并检查对象的指针的合法性；</li><li>检查给定的开始和结束点是否在合法范围内；</li><li>检查给定的开始和长度是否在合法范围内；</li><li>针对 Java 的字符串拷贝。</li></ol><p>1 和 2 都是基于 Java 内存布局进行的加载，并在异常时返回。3 和 4 帮助检查给定的开始和结束是否在合法的长度范围内。</p><h3 id="memcpy-opt" tabindex="-1"><a class="header-anchor" href="#memcpy-opt"><span>MemCpy Opt</span></a></h3><p>Java 的对象是关于 32Bit 对齐的，而 Java 的字符存储分为 Bytes 的压缩格式和 2XBytes 的宽字符格式，</p>',27)]))}const p=a(d,[["render",o]]),l=JSON.parse('{"path":"/java/jvm/jvm_inst.html","title":"JVM Inst","lang":"zh-CN","frontmatter":{"title":"JVM Inst","date":"2024-08-29T00:00:00.000Z","tag":["jvm","java"],"category":["JAVA"],"description":"Abstract JAVA 字符串操作的优化。 Java 对象布局 Java Array 对象布局 Data of Array 中的每个 char 占 2 Bytes. 加载Length的流程包括： 需要通过数组实例的基地址加载Length的值。 如果基地址错误，需要返回错误码。 如果length为0，需要返回错误码。 字符串数组的简化布局： +---...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"JVM Inst\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-08-29T00:00:00.000Z\\",\\"dateModified\\":\\"2025-02-08T02:58:09.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Someone\\",\\"url\\":\\"https://www.weigao.cc\\"}]}"],["meta",{"property":"og:url","content":"https://vueblog.weigao.cc/java/jvm/jvm_inst.html"}],["meta",{"property":"og:site_name","content":"weigao"}],["meta",{"property":"og:title","content":"JVM Inst"}],["meta",{"property":"og:description","content":"Abstract JAVA 字符串操作的优化。 Java 对象布局 Java Array 对象布局 Data of Array 中的每个 char 占 2 Bytes. 加载Length的流程包括： 需要通过数组实例的基地址加载Length的值。 如果基地址错误，需要返回错误码。 如果length为0，需要返回错误码。 字符串数组的简化布局： +---..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-02-08T02:58:09.000Z"}],["meta",{"property":"article:tag","content":"java"}],["meta",{"property":"article:tag","content":"jvm"}],["meta",{"property":"article:published_time","content":"2024-08-29T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-02-08T02:58:09.000Z"}]]},"git":{"createdTime":1724895605000,"updatedTime":1738983489000,"contributors":[{"name":"weigao chen","username":"","email":"weigao_1995@yeah.net","commits":3},{"name":"weigao","username":"weigao","email":"weigao.cwg","commits":1,"url":"https://github.com/weigao"}]},"readingTime":{"minutes":2.53,"words":759},"filePathRelative":"java/jvm/jvm_inst.md","excerpt":"<h2>Abstract</h2>\\n<p>JAVA 字符串操作的优化。</p>\\n<h2>Java 对象布局</h2>\\n<h3>Java Array 对象布局</h3>\\n<table>\\n<thead>\\n<tr>\\n<th>Java Char Array</th>\\n<th></th>\\n<th></th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>Head</td>\\n<td>Mark Word</td>\\n<td>4 Bytes</td>\\n</tr>\\n<tr>\\n<td></td>\\n<td>Class Pointer</td>\\n<td>4 Bytes</td>\\n</tr>\\n<tr>\\n<td></td>\\n<td>Length of Array</td>\\n<td>Offset = 8</td>\\n</tr>\\n<tr>\\n<td>Instance Data</td>\\n<td>Data of Array</td>\\n<td></td>\\n</tr>\\n<tr>\\n<td>Padding</td>\\n<td></td>\\n<td></td>\\n</tr>\\n</tbody>\\n</table>","autoDesc":true}');export{p as comp,l as data};
