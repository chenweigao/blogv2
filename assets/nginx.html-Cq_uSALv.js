import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,d as n,o as e}from"./app-11Vuyqh7.js";const l={};function h(t,s){return e(),a("div",null,s[0]||(s[0]=[n(`<p><a href="http://nginx.org/en/docs/beginners_guide.html" target="_blank" rel="noopener noreferrer">Beginner&#39;s Guide</a></p><h2 id="command" tabindex="-1"><a class="header-anchor" href="#command"><span>Command</span></a></h2><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#24292e;--shiki-dark:#d8dee9ff;--shiki-light-bg:#fff;--shiki-dark-bg:#2e3440ff;"><pre class="shiki shiki-themes github-light nord vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#88C0D0;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#A3BE8C;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#A3BE8C;"> signal</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>-s</code>: signal:</p><ul><li>stop — fast shutdown</li><li>quit — graceful shutdown</li><li>reload — reloading the configuration file</li><li>reopen — reopening the log files</li></ul><p>查看运行 nginx 进程：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#24292e;--shiki-dark:#d8dee9ff;--shiki-light-bg:#fff;--shiki-dark-bg:#2e3440ff;"><pre class="shiki shiki-themes github-light nord vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#88C0D0;">ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#A3BE8C;"> -ax</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#88C0D0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#A3BE8C;"> nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration"><span>Configuration</span></a></h2><p>By default, the configuration file is named <em>nginx.conf</em> and placed in the directory <code>/usr/local/nginx/conf</code>, <code>/etc/nginx</code>, or <code>/usr/local/etc/nginx</code>.</p><blockquote><p>The <code>events</code> and <code>http</code> directives reside in the <code>main</code> context, <code>server</code> in <code>http</code>, and <code>location</code> in <code>server</code>.</p></blockquote><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" style="--shiki-light:#24292e;--shiki-dark:#d8dee9ff;--shiki-light-bg:#fff;--shiki-dark-bg:#2e3440ff;"><pre class="shiki shiki-themes github-light nord vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#ECEFF4;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#ECEFF4;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">        listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;"> 8080</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">        root</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">upl</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#ECEFF4;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">            root</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">www</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ECEFF4;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">        localtion</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">images</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ECEFF4;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">            root</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ECEFF4;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;"> ~</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> \\</span><span style="--shiki-light:#24292E;--shiki-dark:#ECEFF4;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">gif</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">jpg</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">png</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#ECEFF4;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">            root</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">images</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ECEFF4;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ECEFF4;">    }</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>location</code> 未定位到的 URL 将被重定向到 <code>/</code> 下的 root 中。</p><p>Reload 配置：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#24292e;--shiki-dark:#d8dee9ff;--shiki-light-bg:#fff;--shiki-dark-bg:#2e3440ff;"><pre class="shiki shiki-themes github-light nord vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#88C0D0;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#A3BE8C;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#A3BE8C;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>In case something does not work as expected, you may try to find out the reason in <code>access.log</code> and <code>error.log</code> files in the directory <code>/usr/local/nginx/logs</code> or <code>/var/log/nginx</code>.</p></blockquote><h2 id="虚拟主机" tabindex="-1"><a class="header-anchor" href="#虚拟主机"><span>虚拟主机</span></a></h2><p>nginx 可以配置多种类型的虚拟主机：</p><ol><li><p>基于 IP</p></li><li><p>基于域名</p></li><li><p>基于端口</p></li></ol><p>以基于端口的虚拟主机为例，对 <code>nginx.conf</code> 进行配置。</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#24292e;--shiki-dark:#d8dee9ff;--shiki-light-bg:#fff;--shiki-dark-bg:#2e3440ff;"><pre class="shiki shiki-themes github-light nord vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    include </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">      mime.types</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#616E88;">    #default_type  application/octet-stream;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#616E88;">    # 为了使 echo 可用</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    default_type </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">text/html</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;">      8088</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> localhost</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D8DEE9FF;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">            root </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">  html</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">            index </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> index.html index.htm</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#616E88;">        #error_page  404              /404.html;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#616E88;">        # redirect server error pages to the static page /50x.html</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#616E88;">        #</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        error_page </span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;">  500</span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;"> 502</span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;"> 503</span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;"> 504</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">  /50x.html</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#EBCB8B;"> /50x.html </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">            root </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">  html</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#616E88;">    # custom config -- weigao</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;">     8089</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D8DEE9FF;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">            echo</span><span style="--shiki-light:#032F62;--shiki-dark:#A3BE8C;"> &#39;hello server2!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;">     8090</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D8DEE9FF;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">            echo</span><span style="--shiki-light:#032F62;--shiki-dark:#A3BE8C;"> &#39;hello server3!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，访问 8088, 8089, 8090 端口就可以发现不同的输出结果，这样就实现了多个虚拟主机的代理。</p><h2 id="反向代理" tabindex="-1"><a class="header-anchor" href="#反向代理"><span>反向代理</span></a></h2><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#24292e;--shiki-dark:#d8dee9ff;--shiki-light-bg:#fff;--shiki-dark-bg:#2e3440ff;"><pre class="shiki shiki-themes github-light nord vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#616E88;">    # 指定 upstream</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D8DEE9FF;"> to_google </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> localhost:8089;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> localhost:8090;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;">     80</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#616E88;"> # 对外暴露</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">www.google.com</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D8DEE9FF;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">            proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> http://to_google</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#616E88;">            # 使用 http:// + upstream 别名指定</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#616E88;">    # 以下为内部服务器，对外不可见</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;">     8089</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D8DEE9FF;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">            echo</span><span style="--shiki-light:#032F62;--shiki-dark:#A3BE8C;"> &#39;Welcome to google! This is 8089 machine!!!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">            echo</span><span style="--shiki-light:#032F62;--shiki-dark:#A3BE8C;"> &#39;remote_addr=</span><span style="--shiki-light:#032F62;--shiki-dark:#81A1C1;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">remote_addr</span><span style="--shiki-light:#032F62;--shiki-dark:#A3BE8C;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#616E88;"> # 防止逐层代理，获取到真实 ip.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;">     8090</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D8DEE9FF;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        echo</span><span style="--shiki-light:#032F62;--shiki-dark:#A3BE8C;"> &#39;Welcome to google! This is 8090 machine!!!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(记得将 www.google.com 在 host 文件中指向本地，或者注释掉 server_name)</p><p>需要注意，<code>upstream</code> 为关键词，紧跟着的 to_google 为这个 upstream 的别名，在 <code>proxy_pass</code> 中 使用 http:// + 别名的方式指定。</p><p>当 upstream 发现其中有两个 server 可以用的时候，使用轮询策略（默认）依次访问 8089 和 8090, 个人猜测会不会也用 epoll?</p><h2 id="负载均衡" tabindex="-1"><a class="header-anchor" href="#负载均衡"><span>负载均衡</span></a></h2><h3 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h3><p>Nginx 的负载均衡策略有三种：</p><ol><li><p>RR 每个请求按照时间顺序逐一分配到不同的后端服务器；</p></li><li><p>权重 指定轮询几率，weight 和访问比率成正比，用于后端服务器性能不均的情况。</p></li><li><p>ip_hash 按访问 ip 的 hash 结果分配。</p></li></ol><p>upstream 用于负载均衡的时候，可以支持以下参数：</p><ul><li><p>weight：权重，常用于机器性能不均衡时，权重越大被访问的几率越大。</p></li><li><p>down：用于其他 server 设置当前不参与负载均衡，即访问不到</p></li><li><p>backup：用于其他 server 无法访问或者忙时备用 server</p></li><li><p>max_fails：server 允许请求失败的次数</p></li><li><p>fail_timeout：请求失败次数达到 max_fails 时，指定 server 停留多久，以便管理员检测故障原因</p></li></ul><p>例子：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#24292e;--shiki-dark:#d8dee9ff;--shiki-light-bg:#fff;--shiki-dark-bg:#2e3440ff;"><pre class="shiki shiki-themes github-light nord vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D8DEE9FF;"> loadBalance </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> localhost:8090 </span><span style="--shiki-light:#E36209;--shiki-dark:#D8DEE9;">weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">    server localhost:8091 </span><span style="--shiki-light:#E36209;--shiki-dark:#D8DEE9;">weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> backup;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ip-hash" tabindex="-1"><a class="header-anchor" href="#ip-hash"><span>ip_hash</span></a></h3><p>每个请求按访问 IP 的 hash 结果分配，这样来自同一 IP 访客固定访问一个后端服务器，有效解决了动态网页存在的 sesion 共享问题。</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#24292e;--shiki-dark:#d8dee9ff;--shiki-light-bg:#fff;--shiki-dark-bg:#2e3440ff;"><pre class="shiki shiki-themes github-light nord vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D8DEE9FF;"> loadBalance </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    ip_hash</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> localhost:8090;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> localhost:8091;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>除此之外，还有 url_hash 方法。此方法按访问 url 的 hash 结果来分配请求，使每个 url 定向到同一个后端服务器。此方法再 Nginx 的 hash 软件包中。</p><h3 id="least-conn" tabindex="-1"><a class="header-anchor" href="#least-conn"><span>least_conn</span></a></h3><p>即最少连接数策略，nginx 可以使请求分配到最少连接数的机器上。</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#24292e;--shiki-dark:#d8dee9ff;--shiki-light-bg:#fff;--shiki-dark-bg:#2e3440ff;"><pre class="shiki shiki-themes github-light nord vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D8DEE9FF;"> loadBalance </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    least_conn</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> localhost:8090;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> localhost:8091;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="缓存" tabindex="-1"><a class="header-anchor" href="#缓存"><span>缓存</span></a></h2><p>Nginx 缓存在 <code>ngx_http_proxy_module</code> 下的 几个模块中 <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html" target="_blank" rel="noopener noreferrer">http://nginx.org/en/docs/http/ngx_http_proxy_module.html</a>.</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#24292e;--shiki-dark:#d8dee9ff;--shiki-light-bg:#fff;--shiki-dark-bg:#2e3440ff;"><pre class="shiki shiki-themes github-light nord vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    proxy_cache_path </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">cache/test levels=1:2 keys_zone=myCache:10m maxsize=1g inactive=30s</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;"> 80</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> X-Cache </span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9;">upstream_cache_status</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D8DEE9FF;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">            proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;"> http://localhost:8080</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">            proxy_cache_vaild</span><span style="--shiki-light:#005CC5;--shiki-dark:#B48EAD;">   10s</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#81A1C1;">            proxy_cache </span><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">myCache</span><span style="--shiki-light:#24292E;--shiki-dark:#81A1C1;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#D8DEE9FF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,44)]))}const d=i(l,[["render",h]]),r=JSON.parse(`{"path":"/blogs/Cloud_Server/nginx.html","title":"Nginx 基础总结","lang":"zh-CN","frontmatter":{"title":"Nginx 基础总结","date":"2019-06-10T00:00:00.000Z","tag":["server","nginx"],"category":["Server"],"description":"Beginner's Guide Command -s: signal: stop — fast shutdown quit — graceful shutdown reload — reloading the configuration file reopen — reopening the log files 查看运行 nginx 进程： Conf...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Nginx 基础总结\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2019-06-10T00:00:00.000Z\\",\\"dateModified\\":\\"2022-09-27T15:26:02.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Someone\\",\\"url\\":\\"https://www.weigao.cc\\"}]}"],["meta",{"property":"og:url","content":"https://vueblog.weigao.cc/blogs/Cloud_Server/nginx.html"}],["meta",{"property":"og:site_name","content":"weigao"}],["meta",{"property":"og:title","content":"Nginx 基础总结"}],["meta",{"property":"og:description","content":"Beginner's Guide Command -s: signal: stop — fast shutdown quit — graceful shutdown reload — reloading the configuration file reopen — reopening the log files 查看运行 nginx 进程： Conf..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2022-09-27T15:26:02.000Z"}],["meta",{"property":"article:tag","content":"nginx"}],["meta",{"property":"article:tag","content":"server"}],["meta",{"property":"article:published_time","content":"2019-06-10T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2022-09-27T15:26:02.000Z"}]]},"git":{"createdTime":1644237761000,"updatedTime":1664292362000,"contributors":[{"name":"chenweigao","username":"chenweigao","email":"297859260@qq.com","commits":5,"url":"https://github.com/chenweigao"}]},"readingTime":{"minutes":3.13,"words":938},"filePathRelative":"blogs/Cloud&Server/nginx.md","excerpt":"<p><a href=\\"http://nginx.org/en/docs/beginners_guide.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Beginner's Guide</a></p>\\n<h2>Command</h2>\\n<div class=\\"language-sh line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"sh\\" style=\\"--shiki-light:#24292e;--shiki-dark:#d8dee9ff;--shiki-light-bg:#fff;--shiki-dark-bg:#2e3440ff\\"><pre class=\\"shiki shiki-themes github-light nord vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#88C0D0\\">nginx</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#A3BE8C\\"> -s</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#A3BE8C\\"> signal</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div>","autoDesc":true}`);export{d as comp,r as data};
