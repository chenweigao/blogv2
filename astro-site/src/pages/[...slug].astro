---
import { getCollection, render } from 'astro:content';
import DocLayout from '../layouts/DocLayout.astro';

export async function getStaticPaths() {
  const docs = await getCollection('docs');
  return docs.map((entry) => ({
    params: { slug: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

// Extract title from frontmatter or first heading
const title = entry.data.title || entry.id.split('/').pop()?.replace(/-/g, ' ') || 'Untitled';

// Normalize tags
const tags = entry.data.tags || (entry.data.tag ? (Array.isArray(entry.data.tag) ? entry.data.tag : [entry.data.tag]) : []);
---

<DocLayout 
  title={title}
  description={entry.data.description}
  date={entry.data.date}
  category={entry.data.category}
  tags={tags}
  lastUpdated={entry.data.lastUpdated}
  filePath={`docs/${entry.id}.md`}
>
  <Content />
</DocLayout>
