---
import { getCollection, render } from 'astro:content';
import DocLayout from '../layouts/DocLayout.astro';

export async function getStaticPaths() {
  const docs = await getCollection('docs');
  return docs.map((entry) => {
    // Remove trailing /index from the slug for index pages
    let slug = entry.id;
    if (slug.endsWith('/index')) {
      slug = slug.slice(0, -6) || 'index'; // Remove '/index', keep root as 'index'
    }
    if (slug === 'index') {
      slug = ''; // Root index becomes empty slug (handled by index.astro)
    }
    return {
      params: { slug },
      props: { entry },
    };
  });
}

const { entry } = Astro.props;
const { Content } = await render(entry);

// Extract title from frontmatter or first heading
const title = entry.data.title || entry.id.split('/').pop()?.replace(/-/g, ' ') || 'Untitled';

// Normalize tags
const tags = entry.data.tags || (entry.data.tag ? (Array.isArray(entry.data.tag) ? entry.data.tag : [entry.data.tag]) : []);
---

<DocLayout 
  title={title}
  description={entry.data.description}
  date={entry.data.date}
  category={entry.data.category}
  tags={tags}
  lastUpdated={entry.data.lastUpdated}
  filePath={`docs/${entry.id}.md`}
>
  <Content />
</DocLayout>
