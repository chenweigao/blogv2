/* 修复代码块点击后悬停样式变化的问题 */

/* 统一代码块的 hover 和 focus 样式，确保点击前后悬停效果一致 */
pre, 
code, 
.language-text,
[class*="language-"],
.shiki,
.code-block,
.markdown-preview-view pre,
.markdown-preview-view code,
.clickable-code-block {
  /* 移除默认的 focus outline */
  outline: none !important;
  
  /* 确保所有状态的过渡效果一致 */
  transition: all 0.2s ease !important;
}

/* 代码块 hover 状态 - 只对最外层容器应用悬停效果，避免嵌套冲突 */
/* 优先级：容器 > pre > code，避免双重效果 */
div[class*="language-"]:hover,
.code-block:hover,
.highlight:hover,
.code-container:hover,
.code-wrapper:hover,
.highlighter-rouge:hover {
  /* 使用统一的 hover 样式 */
  border-color: var(--vp-c-border-hover, var(--border-color, #e2e8f0)) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-1px) !important;
  background-color: var(--vp-c-bg-soft, #f8f9fa) !important;
}

/* 对于没有容器包裹的 pre 元素，但排除嵌套在语言容器内的 pre */
pre:hover:not(div[class*="language-"] pre):not(.code-block pre):not(.highlight pre) {
  border-color: var(--vp-c-border-hover, var(--border-color, #e2e8f0)) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-1px) !important;
  background-color: var(--vp-c-bg-soft, #f8f9fa) !important;
}

/* 对于独立的 code 元素（不在 pre 内），但排除嵌套的 code */
code:hover:not(pre code):not(div[class*="language-"] code) {
  border-color: var(--vp-c-border-hover, var(--border-color, #e2e8f0)) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-1px) !important;
  background-color: var(--vp-c-bg-soft, #f8f9fa) !important;
}

/* 特殊处理：VitePress 和 Markdown 预览的代码块 */
.vp-doc pre:hover:not(div[class*="language-"] pre),
.markdown-preview-view pre:hover:not(.code-block pre) {
  border-color: var(--vp-c-border-hover, var(--border-color, #e2e8f0)) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-1px) !important;
  background-color: var(--vp-c-bg-soft, #f8f9fa) !important;
}

/* 可点击代码块的悬停效果 */
.clickable-code-block:hover {
  border-color: var(--vp-c-border-hover, var(--border-color, #e2e8f0)) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-1px) !important;
  background-color: var(--vp-c-bg-soft, #f8f9fa) !important;
}

/* 禁用嵌套元素的悬停效果，防止双重效果 */
div[class*="language-"] pre:hover,
div[class*="language-"] code:hover,
.code-block pre:hover,
.code-block code:hover,
.highlight pre:hover,
.highlight code:hover,
pre code:hover {
  /* 重置嵌套元素的悬停效果 */
  border-color: inherit !important;
  box-shadow: none !important;
  transform: none !important;
  background-color: inherit !important;
}

/* Focus 状态 - 应用相同的逻辑 */
div[class*="language-"]:focus,
.code-block:focus,
.highlight:focus,
.code-container:focus,
.code-wrapper:focus,
.highlighter-rouge:focus {
  border-color: var(--vp-c-border-hover, var(--border-color, #e2e8f0)) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-1px) !important;
  background-color: var(--vp-c-bg-soft, #f8f9fa) !important;
  outline: none !important;
}

pre:focus:not(div[class*="language-"] pre):not(.code-block pre):not(.highlight pre) {
  border-color: var(--vp-c-border-hover, var(--border-color, #e2e8f0)) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-1px) !important;
  background-color: var(--vp-c-bg-soft, #f8f9fa) !important;
  outline: none !important;
}

code:focus:not(pre code):not(div[class*="language-"] code) {
  border-color: var(--vp-c-border-hover, var(--border-color, #e2e8f0)) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-1px) !important;
  background-color: var(--vp-c-bg-soft, #f8f9fa) !important;
  outline: none !important;
}

.clickable-code-block:focus {
  border-color: var(--vp-c-border-hover, var(--border-color, #e2e8f0)) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-1px) !important;
  background-color: var(--vp-c-bg-soft, #f8f9fa) !important;
  outline: none !important;
}

/* 禁用嵌套元素的 focus 效果 */
div[class*="language-"] pre:focus,
div[class*="language-"] code:focus,
.code-block pre:focus,
.code-block code:focus,
.highlight pre:focus,
.highlight code:focus,
pre code:focus {
  border-color: inherit !important;
  box-shadow: none !important;
  transform: none !important;
  background-color: inherit !important;
  outline: none !important;
}

/* Focus-visible 状态处理 */
div[class*="language-"]:focus-visible,
.code-block:focus-visible,
.highlight:focus-visible,
pre:focus-visible:not(div[class*="language-"] pre):not(.code-block pre),
code:focus-visible:not(pre code):not(div[class*="language-"] code),
.clickable-code-block:focus-visible {
  outline: none !important;
  border-color: var(--vp-c-border-hover, var(--border-color, #e2e8f0)) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-1px) !important;
  background-color: var(--vp-c-bg-soft, #f8f9fa) !important;
}

/* Active 状态处理 */
div[class*="language-"]:active,
.code-block:active,
.highlight:active,
pre:active:not(div[class*="language-"] pre):not(.code-block pre),
code:active:not(pre code):not(div[class*="language-"] code),
.clickable-code-block:active {
  border-color: var(--vp-c-border-hover, var(--border-color, #e2e8f0)) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-1px) !important;
  background-color: var(--vp-c-bg-soft, #f8f9fa) !important;
  outline: none !important;
}

/* 特别处理可能的代码块容器 */
.code-container,
.code-wrapper,
.highlighter-rouge {
  outline: none !important;
}

/* 移除浏览器默认的蓝色 focus ring */
*:focus {
  outline: none !important;
}

/* 为可访问性保留键盘导航的 focus 指示 */
*:focus-visible {
  outline: 2px solid var(--vp-c-brand-1, #646cff) !important;
  outline-offset: 2px !important;
}

/* 但对于代码块，即使是键盘导航也使用统一样式 */
div[class*="language-"]:focus-visible,
.code-block:focus-visible,
.highlight:focus-visible,
.clickable-code-block:focus-visible {
  outline: none !important;
}

/* 确保点击后立即失去焦点时的样式重置 */
.clickable-code-block.clicked {
  animation: resetFocus 0.1s ease-out;
}

@keyframes resetFocus {
  0% {
    transform: translateY(-1px);
  }
  100% {
    transform: translateY(0);
  }
}

/* VitePress 特定的代码块样式修复 */
.vp-doc div[class*="language-"]:hover,
.vp-doc .code-block:hover {
  border-color: var(--vp-c-border-hover, var(--border-color, #e2e8f0)) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-1px) !important;
  background-color: var(--vp-c-bg-soft, #f8f9fa) !important;
}

.vp-doc div[class*="language-"]:focus,
.vp-doc .code-block:focus {
  border-color: var(--vp-c-border-hover, var(--border-color, #e2e8f0)) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-1px) !important;
  background-color: var(--vp-c-bg-soft, #f8f9fa) !important;
  outline: none !important;
}

/* 确保嵌套在 VitePress 容器内的元素不触发悬停效果 */
.vp-doc div[class*="language-"] pre:hover,
.vp-doc div[class*="language-"] code:hover,
.vp-doc .code-block pre:hover,
.vp-doc .code-block code:hover {
  border-color: inherit !important;
  box-shadow: none !important;
  transform: none !important;
  background-color: inherit !important;
}