/* ============================================
   Glassmorphism Fallback Styles
   Requirement 7.8: Fallback for unsupported browsers
   ============================================ */

/* 
 * This file provides solid background fallbacks for browsers
 * that don't support backdrop-filter (e.g., older Firefox, IE).
 * 
 * The @supports rule checks for backdrop-filter support and
 * provides alternative styling when not available.
 */

/* ========================================
   1. Feature Detection Variables
   ======================================== */

:root {
  /* Fallback background colors - Light Mode */
  --fallback-bg-navbar: #FAFAFA;
  --fallback-bg-sidebar: #F5F5F7;
  --fallback-bg-card: #FFFFFF;
  --fallback-bg-modal: #FFFFFF;
  --fallback-bg-code: #F5F5F7;
  --fallback-bg-glass: #FAFAFA;
  --fallback-bg-glass-heavy: #FFFFFF;
  --fallback-bg-glass-light: #F5F5F7;
  
  /* Fallback opacity for semi-transparent effect simulation */
  --fallback-opacity: 0.98;
}

.dark {
  /* Fallback background colors - Dark Mode */
  --fallback-bg-navbar: #1C1C1E;
  --fallback-bg-sidebar: #1C1C1E;
  --fallback-bg-card: #2C2C2E;
  --fallback-bg-modal: #1C1C1E;
  --fallback-bg-code: #2C2C2E;
  --fallback-bg-glass: #1C1C1E;
  --fallback-bg-glass-heavy: #2C2C2E;
  --fallback-bg-glass-light: #1C1C1E;
}

/* ========================================
   2. Global Glassmorphism Fallback
   @supports not (backdrop-filter: blur(1px))
   ======================================== */

@supports not (backdrop-filter: blur(1px)) {
  /* ----------------------------------------
     Generic Glass Classes
     ---------------------------------------- */
  .glass {
    background: var(--fallback-bg-glass) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    opacity: var(--fallback-opacity);
  }
  
  .glass-light {
    background: var(--fallback-bg-glass-light) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    opacity: var(--fallback-opacity);
  }
  
  .glass-heavy {
    background: var(--fallback-bg-glass-heavy) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    opacity: var(--fallback-opacity);
  }
  
  .glass-ultra {
    background: var(--fallback-bg-glass-heavy) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    opacity: 1;
  }
  
  /* ----------------------------------------
     Navbar Fallback
     ---------------------------------------- */
  .VPNav,
  .VPNavBar,
  .glass-navbar {
    background: var(--fallback-bg-navbar) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    opacity: var(--fallback-opacity);
    /* Maintain border for definition */
    border-color: var(--vp-c-border) !important;
  }
  
  .VPNav .VPNavBarMenuGroup .VPNavBarMenuGroupItems {
    background: var(--fallback-bg-navbar) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
  
  /* ----------------------------------------
     Sidebar Fallback
     ---------------------------------------- */
  .VPSidebar,
  .glass-sidebar {
    background: var(--fallback-bg-sidebar) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    opacity: var(--fallback-opacity);
  }
  
  /* ----------------------------------------
     Card Fallback
     ---------------------------------------- */
  .vp-card,
  .glass-card,
  .VPFeature,
  .VPFeatures .item,
  .related-item {
    background: var(--fallback-bg-card) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    opacity: var(--fallback-opacity);
  }
  
  /* ----------------------------------------
     Modal Fallback
     ---------------------------------------- */
  .glass-modal,
  .modal,
  .VPLocalSearchBox .shell {
    background: var(--fallback-bg-modal) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    opacity: 1;
  }
  
  /* ----------------------------------------
     Code Block Fallback
     ---------------------------------------- */
  .vp-doc div[class*="language-"] {
    background: var(--fallback-bg-code) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
  
  .vp-doc div[class*="language-"] button.copy {
    background: var(--vp-c-bg) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
  
  /* ----------------------------------------
     Hero Section Fallback
     ---------------------------------------- */
  .VPHero .VPButton.alt {
    background: var(--vp-c-bg-alt) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
  
  /* ----------------------------------------
     TOC and Panels Fallback
     ---------------------------------------- */
  .toc-panel,
  .quick-toc-preview {
    background: var(--fallback-bg-card) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
  
  /* ----------------------------------------
     Input and Form Elements Fallback
     ---------------------------------------- */
  .input-apple,
  .btn-apple-secondary {
    background: var(--vp-c-bg-alt) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
  
  /* ----------------------------------------
     Search Box Fallback
     ---------------------------------------- */
  .VPNavBarSearch .DocSearch-Button {
    background: var(--vp-c-bg-alt) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
  
  /* ----------------------------------------
     Doc Header Container Fallback
     ---------------------------------------- */
  .doc-header-container {
    background: var(--fallback-bg-card) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
  
  /* ----------------------------------------
     Article Tags Fallback
     ---------------------------------------- */
  .article-tag {
    background: var(--vp-c-bg-soft) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
}

/* ========================================
   3. WebKit-specific Fallback
   For browsers that support -webkit-backdrop-filter but not standard
   ======================================== */

@supports (-webkit-backdrop-filter: blur(1px)) and (not (backdrop-filter: blur(1px))) {
  /* Use webkit prefix for these browsers */
  .glass,
  .glass-light,
  .glass-heavy,
  .glass-ultra,
  .glass-navbar,
  .glass-sidebar,
  .glass-card,
  .glass-modal,
  .VPNav,
  .VPSidebar {
    -webkit-backdrop-filter: blur(var(--vp-blur-md, 16px));
    backdrop-filter: none;
  }
}

/* ========================================
   4. Reduced Transparency Fallback
   For users who prefer reduced transparency
   ======================================== */

@media (prefers-reduced-transparency: reduce) {
  /* Remove all glassmorphism effects */
  .glass,
  .glass-light,
  .glass-heavy,
  .glass-ultra,
  .glass-navbar,
  .glass-sidebar,
  .glass-card,
  .glass-modal,
  .VPNav,
  .VPNavBar,
  .VPSidebar,
  .VPFeature,
  .vp-card,
  .related-item,
  .doc-header-container,
  .toc-panel,
  .quick-toc-preview,
  .vp-doc div[class*="language-"],
  .VPHero .VPButton.alt,
  .input-apple,
  .btn-apple-secondary {
    background: var(--vp-c-bg) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    opacity: 1 !important;
  }
  
  .dark .glass,
  .dark .glass-light,
  .dark .glass-heavy,
  .dark .glass-ultra,
  .dark .glass-navbar,
  .dark .glass-sidebar,
  .dark .glass-card,
  .dark .glass-modal,
  .dark .VPNav,
  .dark .VPNavBar,
  .dark .VPSidebar,
  .dark .VPFeature,
  .dark .vp-card,
  .dark .related-item,
  .dark .doc-header-container,
  .dark .toc-panel,
  .dark .quick-toc-preview,
  .dark .vp-doc div[class*="language-"],
  .dark .VPHero .VPButton.alt,
  .dark .input-apple,
  .dark .btn-apple-secondary {
    background: var(--vp-c-bg-alt) !important;
  }
}

/* ========================================
   5. High Contrast Mode Fallback
   Solid backgrounds for high contrast mode
   ======================================== */

@media (prefers-contrast: high) {
  /* Remove all glassmorphism for maximum contrast */
  .glass,
  .glass-light,
  .glass-heavy,
  .glass-ultra,
  .glass-navbar,
  .glass-sidebar,
  .glass-card,
  .glass-modal,
  .VPNav,
  .VPNavBar,
  .VPSidebar,
  .VPFeature,
  .vp-card,
  .related-item {
    background: var(--vp-c-bg) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    border-width: 2px !important;
    border-color: var(--vp-c-border) !important;
  }
  
  .dark .glass,
  .dark .glass-light,
  .dark .glass-heavy,
  .dark .glass-ultra,
  .dark .glass-navbar,
  .dark .glass-sidebar,
  .dark .glass-card,
  .dark .glass-modal,
  .dark .VPNav,
  .dark .VPNavBar,
  .dark .VPSidebar,
  .dark .VPFeature,
  .dark .vp-card,
  .dark .related-item {
    background: var(--vp-c-bg) !important;
    border-color: var(--vp-c-border) !important;
  }
}

/* ========================================
   6. Forced Colors Mode (Windows High Contrast)
   ======================================== */

@media (forced-colors: active) {
  /* Use system colors for forced colors mode */
  .glass,
  .glass-light,
  .glass-heavy,
  .glass-ultra,
  .glass-navbar,
  .glass-sidebar,
  .glass-card,
  .glass-modal,
  .VPNav,
  .VPNavBar,
  .VPSidebar,
  .VPFeature,
  .vp-card,
  .related-item,
  .doc-header-container,
  .toc-panel,
  .quick-toc-preview,
  .vp-doc div[class*="language-"] {
    background: Canvas !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    border: 2px solid CanvasText !important;
    color: CanvasText !important;
  }
}

/* ========================================
   7. Print Fallback
   Solid backgrounds for printing
   ======================================== */

@media print {
  .glass,
  .glass-light,
  .glass-heavy,
  .glass-ultra,
  .glass-navbar,
  .glass-sidebar,
  .glass-card,
  .glass-modal,
  .VPNav,
  .VPNavBar,
  .VPSidebar,
  .VPFeature,
  .vp-card,
  .related-item,
  .doc-header-container,
  .toc-panel,
  .quick-toc-preview,
  .vp-doc div[class*="language-"] {
    background: #FFFFFF !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    box-shadow: none !important;
    border: 1px solid #CCCCCC !important;
  }
}

/* ========================================
   8. Legacy Browser Detection
   Additional fallbacks for older browsers
   ======================================== */

/* 
 * For browsers that don't support @supports at all,
 * we provide base fallback styles that work everywhere.
 * Modern browsers will override these with the glassmorphism styles.
 */

/* Base fallback - will be overridden by @supports rules in other files */
.glass-fallback-base {
  background: var(--vp-c-bg);
  border: 1px solid var(--vp-c-border);
}

.dark .glass-fallback-base {
  background: var(--vp-c-bg-alt);
}
