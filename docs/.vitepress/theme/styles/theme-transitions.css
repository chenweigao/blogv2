/* ============================================
   Theme Transition Smoothness
   Requirement 7.6: Smooth color transitions on theme switch
   ============================================ */

/* ========================================
   1. Theme Transition Variables
   ======================================== */

:root {
  /* Theme transition timing (200-300ms range per Req 7.6) */
  --theme-transition-duration: 250ms;
  --theme-transition-easing: var(--vp-animation-easing-out, cubic-bezier(0, 0, 0.2, 1));
  
  /* Composite theme transition */
  --theme-transition: 
    color var(--theme-transition-duration) var(--theme-transition-easing),
    background-color var(--theme-transition-duration) var(--theme-transition-easing),
    border-color var(--theme-transition-duration) var(--theme-transition-easing),
    box-shadow var(--theme-transition-duration) var(--theme-transition-easing),
    fill var(--theme-transition-duration) var(--theme-transition-easing),
    stroke var(--theme-transition-duration) var(--theme-transition-easing);
}

/* ========================================
   2. Global Theme Transition Application
   Smooth transitions for all color-related properties
   ======================================== */

/* Apply theme transitions to key elements */
html,
body,
.VPNav,
.VPNavBar,
.VPSidebar,
.VPContent,
.VPDoc,
.VPHome,
.VPHero,
.VPFeature,
.VPFeatures,
.vp-doc,
.glass,
.glass-navbar,
.glass-sidebar,
.glass-card,
.glass-modal {
  transition: var(--theme-transition);
}

/* Navigation elements */
.VPNavBarMenuLink,
.VPNavBarMenuGroup,
.VPNavBarTitle,
.VPNavBarSearch,
.VPSocialLinks,
.VPNavBarAppearance,
.VPNavBarHamburger {
  transition: var(--theme-transition);
}

/* Sidebar elements */
.VPSidebarItem,
.VPSidebarItem .link,
.VPSidebarItem .item,
.VPSidebarItem .caret {
  transition: var(--theme-transition);
}

/* Content elements */
.vp-doc h1,
.vp-doc h2,
.vp-doc h3,
.vp-doc h4,
.vp-doc h5,
.vp-doc h6,
.vp-doc p,
.vp-doc a,
.vp-doc li,
.vp-doc blockquote,
.vp-doc table,
.vp-doc th,
.vp-doc td,
.vp-doc code,
.vp-doc pre {
  transition: var(--theme-transition);
}

/* Code blocks */
.vp-doc div[class*="language-"],
.vp-doc div[class*="language-"] pre,
.vp-doc div[class*="language-"] code,
.vp-doc div[class*="language-"] .line,
.vp-doc div[class*="language-"] button.copy,
.vp-doc div[class*="language-"] span.lang {
  transition: var(--theme-transition);
}

/* Cards and interactive elements */
.vp-card,
.glass-card,
.VPButton,
.related-item,
.doc-header-container,
.article-tag,
.breadcrumb-link {
  transition: var(--theme-transition);
}

/* TOC elements */
.toc-link,
.toc-panel,
.quick-toc-preview,
.quick-toc-item {
  transition: var(--theme-transition);
}

/* Form elements */
input,
select,
textarea,
button {
  transition: var(--theme-transition);
}

/* Scrollbar (for browsers that support it) */
::-webkit-scrollbar-thumb,
::-webkit-scrollbar-track {
  transition: background-color var(--theme-transition-duration) var(--theme-transition-easing);
}

/* ========================================
   3. Flash Prevention During Theme Switch
   Prevent flash of unstyled content (FOUC)
   ======================================== */

/* 
 * During theme transition, temporarily disable all transitions
 * to prevent jarring visual effects. This class is added/removed
 * by JavaScript during theme switch.
 */
html.theme-transitioning,
html.theme-transitioning *,
html.theme-transitioning *::before,
html.theme-transitioning *::after {
  transition-duration: 0ms !important;
}

/* 
 * Alternative: Use a brief blocking transition
 * This ensures the theme switch happens atomically
 */
html.theme-switching {
  /* Block pointer events during switch */
  pointer-events: none;
}

html.theme-switching * {
  /* Instant transition during switch */
  transition: none !important;
}

/* Re-enable transitions after switch completes */
html:not(.theme-transitioning):not(.theme-switching) {
  /* Normal transitions apply - inherits from global rules */
  transition: var(--theme-transition);
}

/* ========================================
   4. VitePress Theme Toggle Enhancement
   ======================================== */

/* Theme toggle button smooth transition */
.VPSwitch {
  transition: 
    background-color var(--theme-transition-duration) var(--theme-transition-easing),
    border-color var(--theme-transition-duration) var(--theme-transition-easing),
    box-shadow var(--theme-transition-duration) var(--theme-transition-easing);
}

.VPSwitch .check {
  transition: 
    transform var(--theme-transition-duration) var(--theme-transition-easing),
    background-color var(--theme-transition-duration) var(--theme-transition-easing);
}

/* Theme toggle icons */
.VPSwitchAppearance .vpi-sun,
.VPSwitchAppearance .vpi-moon,
.VPNavBarAppearance .sun,
.VPNavBarAppearance .moon {
  transition: 
    opacity var(--theme-transition-duration) var(--theme-transition-easing),
    transform var(--theme-transition-duration) var(--theme-transition-easing);
}

/* ========================================
   5. Backdrop Filter Transition
   Smooth glassmorphism effect during theme switch
   ======================================== */

/* 
 * Note: backdrop-filter transitions can be expensive.
 * We keep the blur constant and only transition colors.
 */
.glass,
.glass-navbar,
.glass-sidebar,
.glass-card,
.glass-modal,
.VPNav,
.VPSidebar {
  /* Transition only color-related properties, not backdrop-filter */
  transition: 
    background-color var(--theme-transition-duration) var(--theme-transition-easing),
    border-color var(--theme-transition-duration) var(--theme-transition-easing),
    box-shadow var(--theme-transition-duration) var(--theme-transition-easing);
}

/* ========================================
   6. Shadow Transition for Depth Consistency
   Maintain shadow intensity ratios between modes (Req 7.4)
   ======================================== */

/* Elements with shadows should transition smoothly */
.shadow-soft-sm,
.shadow-soft-md,
.shadow-soft-lg,
.shadow-soft-xl,
.shadow-soft-2xl,
.shadow-brand,
.shadow-hover,
.shadow-navbar,
.shadow-sidebar,
.shadow-card,
.shadow-card-hover,
.shadow-code-block,
.shadow-modal {
  transition: box-shadow var(--theme-transition-duration) var(--theme-transition-easing);
}

/* ========================================
   7. SVG and Icon Transitions
   ======================================== */

svg,
.icon,
[class*="vpi-"],
.VPImage {
  transition: 
    fill var(--theme-transition-duration) var(--theme-transition-easing),
    stroke var(--theme-transition-duration) var(--theme-transition-easing),
    color var(--theme-transition-duration) var(--theme-transition-easing),
    opacity var(--theme-transition-duration) var(--theme-transition-easing);
}

/* ========================================
   8. Reduced Motion Support
   Disable theme transitions for users who prefer reduced motion
   ======================================== */

@media (prefers-reduced-motion: reduce) {
  html,
  body,
  *,
  *::before,
  *::after {
    /* Instant theme switch for reduced motion preference */
    --theme-transition-duration: 0ms;
  }
  
  /* Ensure no transitions during theme switch */
  .VPNav,
  .VPNavBar,
  .VPSidebar,
  .VPContent,
  .VPDoc,
  .VPHome,
  .VPHero,
  .VPFeature,
  .vp-doc,
  .glass,
  .glass-navbar,
  .glass-sidebar,
  .glass-card {
    transition: none;
  }
}

/* ========================================
   9. High Contrast Mode
   Ensure transitions don't interfere with high contrast
   ======================================== */

@media (prefers-contrast: high) {
  /* Faster transitions for high contrast mode */
  :root {
    --theme-transition-duration: 150ms;
  }
}

/* ========================================
   10. Print Styles
   Disable transitions for print
   ======================================== */

@media print {
  * {
    transition: none !important;
  }
}
